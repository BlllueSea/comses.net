{% extends "sidebar_layout.jinja" %}
{% from "common.jinja" import breadcrumb, discourse_embed_script %}

{% block title %}{{ title }}{% endblock %}

{% block introduction %}<h1>Computational Model Library</h1>{% endblock %}

{% block top %}
    {{ breadcrumb([
    {'url': url('library:codebase-list'), 'text': 'Computational Model Library' },
    {'text': title }
    ]) }}
{% endblock %}

{% block content %}
    <h1 class="codebase-title pb-4">{{ title }}</h1>
    <div class='metadata'>
        <b>Submitted by:</b> <a href='{{submitter.profile_url}}'>{{submitter.full_name}}</a>
        <b class='pl-2'>Platform:</b>
        {% for p in latest_version.platform_tags %}
            <a class='tag' href='/search?tag={{ p.name }}'>{{ p.name }}</a>
        {% endfor %}
        <b class='pl-2'>Version: </b> {{ latest_version.version_number }}
        <small><a href='{{ latest_version.absolute_url }}'>(View Latest)</a></small>
        <b class='pl-2'>Language:</b>
        {% for pl in latest_version.programming_languages %}
            <a class='tag' href='/search?tag={{ pl.name }}'>{{ pl.name }}</a>
        {% endfor %}
    </div>
    <div class='tags'>
        {% for tag in tags %}
            <a class='tag p-2' href='/search?tag={{ tag.name }}'>{{ tag.name }}</a>
        {% endfor %}
    </div>
    <div id='discourse-content' class='pt-4'>
        {{ description|markdown }}
    </div>
    <div class='card-metadata'>
        <div class='card-block'>
            <h2 class='card-title'>Cite this Model</h2>
            <p class='card-text'>
                {{ latest_version.citation_text|markdown }}
            </p>
        </div>
    </div>
    {% if replication %}
        <div class='card-metadata'>
            <div class='card-block'>
                <h2 class='card-title'>This is a replication of a previously published model</h2>
                <p class='card-text'>
                {{ references_text }}
                </p>
            </div>
        </div>
    {% endif %}
    {% if publication_text %}
        <div class='citation'>
            <div class='card-block'>
                <h2 class='card-title'>Associated Publication</h2>
                <p class='card-text'>
                {{ publication_text }}
                </p>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block sidebar %}
    <div class='card-metadata'>
        <div class='card-block'>
            <div class='section'>
                <b class="card-title">Authors</b>
                <p class='card-text'>
                {% for c in all_contributors %}
                    {% set badge_class='badge-success' if c.username else 'badge-default' %}
                    <a href='{{c.profile_url}}'>
                        <span class='badge {{badge_class}}'>
                            {{ c.name }}
                        </span>
                    </a>
                {% endfor %}
                </p>
            </div>
            <div class='section'>
                <b class="card-title">Publish Date</b>
                <p class='card-text'>
                {{ first_published_at }}
                </p>
            </div>
            <div class='section'>
                <b class="card-title">Last Updated</b>
                <p class='card-text'>
                {{ latest_version.last_published_on }}
                </p>
            </div>
            <div class='section'>
                <b class="card-title">Downloads: </b>{{ download_count }}
            </div>
            <div class='section'>
                <b class="card-title">Status</b>
                <p class="card-text">
                {% if peer_reviewed %}
                    <img src="{{ static("images/icons/peer-reviewed.png") }}" alt="Arizona State University">
                {% elif user == submitter %}
                    {# FIXME: check if user has permissions to request review, currently naive submitter check #}
                    <a class='btn btn-primary'>Request Review</a>
                {% else %}
                    Not reviewed
                {% endif %}
                </p>
            </div>
        </div>
    </div>
    <div class="card-metadata">
        <div class="card-block">
            <button type="button" class="col-12 my-1 btn btn-primary">Download</button>
            <button type="button" class="col-12 my-1 btn btn-primary">Follow</button>
        </div>
    </div>
    <div class="card-metadata">
        <div class="card-block">
            <b>Share</b>
            <span class="col-2 fa fa-linkedin-square"></span>
            <span class="col-2 fa fa-facebook-square"></span>
            <span class="col-2 fa fa-twitter-square"></span>
            <span class="col-2 fa fa-envelope-square"></span>
        </div>
    </div>
{% endblock %}

{% block js %}
    {{ discourse_embed_script() }}
{% endblock %}
