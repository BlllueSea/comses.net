{% extends "sidebar_layout.jinja" %}
{% from "common.jinja" import list_page, paginator, breadcrumb, submit_model_btn %}

{% block title %}CoMSES Net Computational Model Library{% endblock %}

{% block introduction %}<h1>Computational Model Library</h1>{% endblock %}

{% block top %}
    {{ breadcrumb([{'text': 'Computational Model Library'}]) }}
    <div class='py-3'>
        <b class='title'>Sort By:</b> 
        <select class='custom-select'>
            <option value='last_published_on' selected>Most Recent</option>
            <option value='title'>Title</option>
            <option value='author'>Author</option>
            <option value='platform'>Platform</option>
            <option value='language'>Language</option>
        </select>
    </div>
{% endblock %}

{% block content %}
    {{ list_page(__all__, render_codebase_result, 'library:codebase-detail') }}
{% endblock %}

{% block bottom %}
    <div class="col">
        {{ paginator('library:codebase-list', __all__) }}
    </div>
{% endblock %}

{% block sidebar %}
    <div id="sidebar"></div>
{% endblock %}

{% macro render_codebase_result(item, detail_url_name) %}
    <div class="search-result">
        <div class="row">
            <div class="col-md-12 col-lg-3">
                {% if item.featured_image is none %}
                    <img src="holder.js/174x174?text=No submitted images" class="img-fluid img-thumbnail">
                {% else %}
                    <a href="{{ url(detail_url_name, identifier=item.identifier) }}">
                        {{ image(item.featured_image, "fill-174x174", class="img-fluid img-thumbnail") }}
                    </a>
                {% endif %}
            </div>
            <div class="col-md-12 col-lg-9">
                <div class="title">
                    <h1>
                        <a href="{{ url(detail_url_name, identifier=item.identifier) }}">{{ item.title }}</a>
                    </h1>
                    <small>
                        {% for codebase_contributor in item.all_contributors %}
                            {% set badge_class='badge-success' if codebase_contributor.username else 'badge-default' %}
                            <a href="{{ codebase_contributor.profile_url }}">
                                <span class='badge {{badge_class}}'>
                                    {{ codebase_contributor.name }}
                                </span>
                            </a>
                        {% endfor %}
                        | Published {{ item.last_published_on }}
                    </small>
                </div>
                <div class="summary">
                    {{ item.summarized_description|markdown }}
                </div>
                {% if item.tags %}
                    <div class="tag-list">
                        {% for tag in item.tags %}
                            <span class="tag">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}

{% block js %}
    {{ render_bundle('codebase_list') }}
{% endblock %}
