# Generated by Django 2.2.5 on 2019-09-30 21:44

from django.db import migrations
from django.db.models import F


class Migration(migrations.Migration):
    def update_replication_text(apps, schema_editor):
        Codebase = apps.get_model("library", "Codebase")
        Codebase.objects.filter(is_replication=True, replication_text="").exclude(
            references_text=""
        ).update(replication_text=F("references_text"))
        Codebase.objects.filter(is_replication=True).exclude(
            replication_text=""
        ).update(references_text="")

    def unupdate_replication_text(apps, schema_editor):
        Codebase = apps.get_model("library", "Codebase")
        # FIXME: this won't work properly if is_replication isn't set by the subsequent schema migration
        Codebase.objects.filter(is_replication=True, references_text="").exclude(
            replication_text=""
        ).update(references_text=F("replication_text"))
        Codebase.objects.filter(is_replication=True).update(replication_text="")

    dependencies = [
        ("library", "0010_update_reviewer_feedback_help_text"),
    ]

    operations = [
        migrations.RunPython(update_replication_text, unupdate_replication_text),
    ]
